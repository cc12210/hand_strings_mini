{"version":3,"sources":["../../src/sticky/sticky.ts"],"names":[],"mappings":"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","file":"sticky.js","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport props from './props';\nimport config from '../common/config';\nimport type { TdStickyProps } from './type';\nimport pageScrollMixin from '../mixins/page-scroll';\nimport { getRect } from '../common/utils';\n\nconst { prefix } = config;\nconst name = `${prefix}-sticky`;\n\nconst ContainerClass = `.${name}`;\n\nexport interface StickyProps extends TdStickyProps {}\n\n@wxComponent()\nexport default class Sticky extends SuperComponent {\n  externalClasses = [`${prefix}-class`];\n\n  properties = props;\n\n  behaviors = [\n    pageScrollMixin(function (event) {\n      this.onScroll(event);\n    }),\n  ];\n\n  observers = {\n    'offsetTop, disabled, container'() {\n      this.onScroll();\n    },\n  };\n\n  data = {\n    prefix,\n    classPrefix: name,\n    containerStyle: '',\n    contentStyle: '',\n  };\n\n  ready() {\n    this.onScroll();\n  }\n\n  methods = {\n    onScroll(event?: { scrollTop: number }) {\n      const { scrollTop } = event || {};\n      const { container, offsetTop, disabled } = this.properties;\n\n      if (disabled) {\n        this.setDataAfterDiff({\n          isFixed: false,\n          transform: 0,\n        });\n        return;\n      }\n\n      this.scrollTop = scrollTop || this.scrollTop;\n\n      if (typeof container === 'function') {\n        Promise.all([getRect(this, ContainerClass), this.getContainerRect()]).then(([root, container]) => {\n          if (!root || !container) return;\n          if (offsetTop + root.height > container.height + container.top) {\n            this.setDataAfterDiff({\n              isFixed: false,\n              transform: container.height - root.height,\n            });\n          } else if (offsetTop >= root.top) {\n            this.setDataAfterDiff({\n              isFixed: true,\n              height: root.height,\n              transform: 0,\n            });\n          } else {\n            this.setDataAfterDiff({ isFixed: false, transform: 0 });\n          }\n        });\n\n        return;\n      }\n\n      getRect(this, ContainerClass).then((root) => {\n        if (!root) return;\n        if (offsetTop >= root.top) {\n          this.setDataAfterDiff({ isFixed: true, height: root.height });\n          this.transform = 0;\n        } else {\n          this.setDataAfterDiff({ isFixed: false });\n        }\n      });\n    },\n\n    setDataAfterDiff(data: { isFixed: boolean; height?: number; transform?: number }) {\n      const { offsetTop } = this.properties;\n      const { containerStyle: prevContainerStyle, contentStyle: prevContentStyle } = this.data;\n      const { isFixed, height, transform } = data;\n      wx.nextTick(() => {\n        let containerStyle = '';\n        let contentStyle = '';\n\n        if (isFixed) {\n          containerStyle += `height:${height}px;`;\n          contentStyle += `position:fixed;top:${offsetTop}px;`;\n        }\n        if (transform) {\n          const translate = `translate3d(0, ${transform}px, 0)`;\n          contentStyle += `-webkit-transform:${translate};transform:${translate};`;\n        }\n\n        if (prevContainerStyle !== containerStyle || prevContentStyle !== contentStyle) {\n          this.setData({ containerStyle, contentStyle });\n        }\n\n        this.triggerEvent('scroll', {\n          scrollTop: this.scrollTop,\n          isFixed,\n        });\n      });\n    },\n\n    getContainerRect() {\n      const nodesRef: WechatMiniprogram.NodesRef = this.properties.container();\n      return new Promise<WechatMiniprogram.BoundingClientRectCallbackResult>((resolve) =>\n        nodesRef.boundingClientRect(resolve).exec(),\n      );\n    },\n  };\n}\n"]}