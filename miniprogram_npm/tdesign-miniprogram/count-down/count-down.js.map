{"version":3,"sources":["../../src/count-down/count-down.ts"],"names":[],"mappings":"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","file":"count-down.js","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport config from '../common/config';\nimport props from './props';\nimport { isSameSecond, parseFormat, parseTimeData, TimeDataUnit } from './utils';\n\nconst { prefix } = config;\nconst name = `${prefix}-count-down`;\n\n@wxComponent()\nexport default class CountDown extends SuperComponent {\n  externalClasses = [`${prefix}-class`, `${prefix}-class-count`, `${prefix}-class-split`];\n\n  properties = props;\n\n  observers = {\n    time() {\n      this.reset();\n    },\n  };\n\n  data = {\n    prefix,\n    classPrefix: name,\n    timeDataUnit: TimeDataUnit,\n    timeData: parseTimeData(0),\n    formattedTime: '0',\n  };\n\n  timeoutId: null | number = null;\n\n  lifetimes = {\n    detached() {\n      if (this.timeoutId) {\n        clearTimeout(this.timeoutId);\n        this.timeoutId = null;\n      }\n    },\n  };\n\n  methods = {\n    start() {\n      if (this.counting) {\n        return;\n      }\n\n      this.counting = true;\n      this.endTime = Date.now() + this.remain;\n      this.doCount();\n    },\n\n    pause() {\n      this.counting = false;\n      this.timeoutId && clearTimeout(this.timeoutId);\n    },\n\n    reset() {\n      this.pause();\n      this.remain = this.properties.time;\n      this.updateTime(this.remain);\n\n      if (this.properties.autoStart) {\n        this.start();\n      }\n    },\n\n    getTime(): number {\n      return Math.max(this.endTime - Date.now(), 0);\n    },\n\n    updateTime(remain: number) {\n      const { format } = this.properties;\n      this.remain = remain;\n      const timeData = parseTimeData(remain);\n      this.triggerEvent('change', timeData);\n      const { timeText } = parseFormat(remain, format as any as string);\n      const timeRange = format.split(':');\n      this.setData({\n        timeRange,\n        timeData,\n        formattedTime: timeText.replace(/:/g, ' : '),\n      });\n\n      if (remain === 0) {\n        this.pause();\n        this.triggerEvent('finish');\n      }\n    },\n\n    doCount() {\n      this.timeoutId = setTimeout(() => {\n        const time = this.getTime();\n\n        if (this.properties.millisecond) {\n          this.updateTime(time);\n        } else if (!isSameSecond(time, this.remain) || time === 0) {\n          this.updateTime(time);\n        }\n\n        if (time !== 0) {\n          this.doCount();\n        }\n      }, 33); // 30 帧，因此 1000 / 30 = 33\n    },\n  };\n}\n"]}