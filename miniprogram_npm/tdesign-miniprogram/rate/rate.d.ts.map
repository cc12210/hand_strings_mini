{"version":3,"sources":["../../src/rate/rate.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,cAAc,EAAe,MAAM,qBAAqB,CAAC;AASlE,MAAM,CAAC,OAAO,OAAO,IAAK,SAAQ,cAAc;IAC9C,eAAe,WAAuE;IAEtF,UAAU,+BAAS;IAEnB,eAAe;;;QAKb;IAEF,IAAI;;;;;;;;MAQF;IAEF,OAAO;mBACM,4BAA4B,aAAa,KAAK,GAAG,MAAM;iBAkCzD,4BAA4B;uBAGtB,4BAA4B;;oBAU/B,4BAA4B;MASxC;CACH","file":"rate.d.ts","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport config from '../common/config';\nimport props from './props';\nimport { unitConvert, getRect } from '../common/utils';\n\nconst { prefix } = config;\nconst name = `${prefix}-rate`;\n\n@wxComponent()\nexport default class Rate extends SuperComponent {\n  externalClasses = [`${prefix}-class`, `${prefix}-class-icon`, `${prefix}-class-text`];\n\n  properties = props;\n\n  controlledProps = [\n    {\n      key: 'value',\n      event: 'change',\n    },\n  ];\n\n  data = {\n    prefix,\n    classPrefix: name,\n    defaultTexts: ['极差', '失望', '一般', '满意', '惊喜'],\n    tipsVisible: false,\n    tipsLeft: 0,\n    actionType: '',\n    scaleIndex: -1,\n  };\n\n  methods = {\n    onTouch(e: WechatMiniprogram.TouchEvent, eventType: 'tap' | 'move') {\n      const { count, allowHalf, gap, value: currentValue, size } = this.properties;\n      const [touch] = e.touches;\n      const margin = unitConvert(gap);\n      getRect(this, `.${name}__wrapper`).then((rect) => {\n        const { width, left } = rect;\n        const starWidth = (width - (count - 1) * margin) / count;\n        const offsetX = touch.pageX - left;\n        const num = (offsetX + margin) / (starWidth + margin);\n        const remainder = num % 1;\n        const integral = num - remainder;\n        let value = remainder <= 0.5 && allowHalf ? integral + 0.5 : integral + 1;\n\n        if (value > count) {\n          value = count;\n        } else if (value < 0) {\n          value = 0;\n        }\n\n        if (eventType === 'move' || (eventType === 'tap' && allowHalf)) {\n          const left = Math.ceil(value - 1) * (unitConvert(gap) + unitConvert(size)) + unitConvert(size) * 0.5;\n          this.setData({\n            tipsVisible: true,\n            actionType: eventType,\n            scaleIndex: Math.ceil(value),\n            tipsLeft: Math.max(left, 0),\n          });\n        }\n\n        if (value !== currentValue) {\n          this._trigger('change', { value });\n        }\n      });\n    },\n    onTap(e: WechatMiniprogram.TouchEvent) {\n      this.onTouch(e, 'tap');\n    },\n    onTouchMove(e: WechatMiniprogram.TouchEvent) {\n      this.onTouch(e, 'move');\n    },\n    onTouchEnd() {\n      if (this.data.actionType === 'move') {\n        this.setData({}, () => {\n          this.setData({ tipsVisible: false, scaleIndex: -1 });\n        });\n      }\n    },\n    onSelect(e: WechatMiniprogram.TouchEvent) {\n      const { value } = e.currentTarget.dataset;\n      const { actionType } = this.data;\n\n      if (actionType === 'move') return;\n\n      this._trigger('change', { value });\n      setTimeout(() => this.setData({ tipsVisible: false, scaleIndex: -1 }), 300);\n    },\n  };\n}\n"]}