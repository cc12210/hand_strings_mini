{"version":3,"sources":["../../src/rate/rate.ts"],"names":[],"mappings":"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","file":"rate.js","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport config from '../common/config';\nimport props from './props';\nimport { unitConvert, getRect } from '../common/utils';\n\nconst { prefix } = config;\nconst name = `${prefix}-rate`;\n\n@wxComponent()\nexport default class Rate extends SuperComponent {\n  externalClasses = [`${prefix}-class`, `${prefix}-class-icon`, `${prefix}-class-text`];\n\n  properties = props;\n\n  controlledProps = [\n    {\n      key: 'value',\n      event: 'change',\n    },\n  ];\n\n  data = {\n    prefix,\n    classPrefix: name,\n    defaultTexts: ['极差', '失望', '一般', '满意', '惊喜'],\n    tipsVisible: false,\n    tipsLeft: 0,\n    actionType: '',\n    scaleIndex: -1,\n  };\n\n  methods = {\n    onTouch(e: WechatMiniprogram.TouchEvent, eventType: 'tap' | 'move') {\n      const { count, allowHalf, gap, value: currentValue, size } = this.properties;\n      const [touch] = e.touches;\n      const margin = unitConvert(gap);\n      getRect(this, `.${name}__wrapper`).then((rect) => {\n        const { width, left } = rect;\n        const starWidth = (width - (count - 1) * margin) / count;\n        const offsetX = touch.pageX - left;\n        const num = (offsetX + margin) / (starWidth + margin);\n        const remainder = num % 1;\n        const integral = num - remainder;\n        let value = remainder <= 0.5 && allowHalf ? integral + 0.5 : integral + 1;\n\n        if (value > count) {\n          value = count;\n        } else if (value < 0) {\n          value = 0;\n        }\n\n        if (eventType === 'move' || (eventType === 'tap' && allowHalf)) {\n          const left = Math.ceil(value - 1) * (unitConvert(gap) + unitConvert(size)) + unitConvert(size) * 0.5;\n          this.setData({\n            tipsVisible: true,\n            actionType: eventType,\n            scaleIndex: Math.ceil(value),\n            tipsLeft: Math.max(left, 0),\n          });\n        }\n\n        if (value !== currentValue) {\n          this._trigger('change', { value });\n        }\n      });\n    },\n    onTap(e: WechatMiniprogram.TouchEvent) {\n      this.onTouch(e, 'tap');\n    },\n    onTouchMove(e: WechatMiniprogram.TouchEvent) {\n      this.onTouch(e, 'move');\n    },\n    onTouchEnd() {\n      if (this.data.actionType === 'move') {\n        this.setData({}, () => {\n          this.setData({ tipsVisible: false, scaleIndex: -1 });\n        });\n      }\n    },\n    onSelect(e: WechatMiniprogram.TouchEvent) {\n      const { value } = e.currentTarget.dataset;\n      const { actionType } = this.data;\n\n      if (actionType === 'move') return;\n\n      this._trigger('change', { value });\n      setTimeout(() => this.setData({ tipsVisible: false, scaleIndex: -1 }), 300);\n    },\n  };\n}\n"]}