{"version":3,"sources":["../../src/calendar/calendar.ts"],"names":[],"mappings":"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","file":"calendar.js","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport config from '../common/config';\nimport props from './props';\nimport TCalendar from '../common/shared/calendar/index';\nimport { TdCalendarProps } from './type';\n\nconst { prefix } = config;\nconst name = `${prefix}-calendar`;\n\nexport interface CalendarProps extends TdCalendarProps {}\n\n@wxComponent()\nexport default class Calendar extends SuperComponent {\n  externalClasses = [`${prefix}-class`];\n\n  options: WechatMiniprogram.Component.ComponentOptions = {\n    multipleSlots: true,\n    styleIsolation: 'apply-shared',\n  };\n\n  properties = props;\n\n  data = {\n    prefix,\n    classPrefix: name,\n    months: [],\n    scrollIntoView: '',\n    innerConfirmBtn: { content: '确定' },\n  };\n\n  controlledProps = [\n    {\n      key: 'value',\n      event: 'confirm',\n    },\n    {\n      key: 'value',\n      event: 'change',\n    },\n  ];\n\n  lifetimes = {\n    ready() {\n      this.base = new TCalendar(this.properties);\n      this.initialValue();\n      this.setData({\n        days: this.base.getDays(),\n      });\n      this.calcMonths();\n    },\n  };\n\n  observers = {\n    confirmBtn(v) {\n      if (typeof v === 'string') {\n        this.setData({ innerConfirmBtn: v === 'slot' ? 'slot' : { content: v } });\n      } else if (typeof v === 'object') {\n        this.setData({ innerConfirmBtn: v });\n      }\n    },\n    'firstDayOfWeek,minDate,maxDate'(firstDayOfWeek, minDate, maxDate) {\n      if (this.base) {\n        this.base.firstDayOfWeek = firstDayOfWeek;\n        this.base.minDate = minDate;\n        this.base.maxDate = maxDate;\n        this.calcMonths();\n      }\n    },\n    value(v) {\n      if (this.base) {\n        this.base.value = v;\n      }\n    },\n    visible(v) {\n      if (v) {\n        this.scrollIntoView();\n\n        if (this.base) {\n          this.base.value = this.data.value;\n          this.calcMonths();\n        }\n      }\n    },\n  };\n\n  methods = {\n    initialValue() {\n      const { value, type, minDate } = this.data;\n\n      if (!value) {\n        const today = new Date();\n        const now = minDate || new Date(today.getFullYear(), today.getMonth(), today.getDate()).getTime(); // 获取 0 点的时间戳\n        const initialValue = type === 'single' ? now : [now];\n\n        if (type === 'range') {\n          initialValue[1] = now + 24 * 3600 * 1000; // 第二天\n        }\n\n        this.setData({\n          value: initialValue,\n        });\n        this.base.value = initialValue;\n      }\n    },\n    scrollIntoView() {\n      const { value } = this.data;\n\n      if (!value) return;\n\n      const date = new Date(Array.isArray(value) ? value[0] : value);\n\n      if (date) {\n        this.setData({\n          scrollIntoView: `year_${date.getFullYear()}_month_${date.getMonth()}`,\n        });\n      }\n    },\n    calcMonths() {\n      const months = this.base.getMonths();\n\n      this.setData({\n        months,\n      });\n    },\n    close(trigger) {\n      if (this.data.autoClose) {\n        this.setData({ visible: false });\n      }\n      this.triggerEvent('close', { trigger });\n    },\n    onVisibleChange() {\n      this.close('overlay');\n    },\n    handleClose() {\n      this.close('close-btn');\n    },\n    handleSelect(e) {\n      const { date, year, month } = e.currentTarget.dataset;\n\n      if (date.type === 'disabled') return;\n\n      const rawValue = this.base.select({ cellType: date.type, year, month, date: date.day });\n      const value = this.toTime(rawValue);\n      this.calcMonths();\n\n      if (this.data.confirmBtn == null) {\n        // 不显示确认按钮，则选择完即关闭 popup\n        if (this.data.type === 'single' || rawValue.length === 2) {\n          this.setData({ visible: false });\n          this._trigger('change', { value }); // 受控\n        }\n      }\n\n      this.triggerEvent('select', { value });\n    },\n    onTplButtonTap() {\n      const rawValue = this.base.getTrimValue();\n      const value = this.toTime(rawValue);\n\n      this.close('confirm-btn');\n      this._trigger('confirm', { value });\n    },\n    toTime(val) {\n      if (Array.isArray(val)) {\n        return val.map((item) => item.getTime());\n      }\n      return val.getTime();\n    },\n  };\n}\n"]}