{"version":3,"sources":["../../src/notice-bar/notice-bar.ts"],"names":[],"mappings":"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","file":"notice-bar.js","sourcesContent":["import { SuperComponent, wxComponent, ComponentsOptionsType } from '../common/src/index';\nimport { getRect, getAnimationFrame, calcIcon } from '../common/utils';\nimport props from './props';\nimport config from '../common/config';\n\nconst { prefix } = config;\nconst name = `${prefix}-notice-bar`;\n\n@wxComponent()\nexport default class NoticeBar extends SuperComponent {\n  externalClasses = [\n    `${prefix}-class`,\n    `${prefix}-class-content`,\n    `${prefix}-class-prefix-icon`,\n    `${prefix}-class-extra`,\n    `${prefix}-class-suffix-icon`,\n  ];\n\n  options: ComponentsOptionsType = {\n    styleIsolation: 'apply-shared',\n    multipleSlots: true,\n  };\n\n  properties = props;\n\n  data = {\n    prefix,\n    classPrefix: name,\n    loop: -1,\n  };\n\n  observers = {\n    marquee(val) {\n      if (JSON.stringify(val) === '{}' || JSON.stringify(val) === 'true') {\n        this.setData({\n          marquee: {\n            speed: 50,\n            loop: -1,\n            delay: 0,\n          },\n        });\n      }\n    },\n\n    visible(visible) {\n      if (visible) {\n        this.show();\n      } else {\n        this.clearNoticeBarAnimation();\n      }\n    },\n\n    prefixIcon(prefixIcon) {\n      this.setPrefixIcon(prefixIcon);\n    },\n\n    suffixIcon(v) {\n      this.setData({\n        _suffixIcon: calcIcon(v),\n      });\n    },\n\n    content() {\n      this.clearNoticeBarAnimation();\n      this.initAnimation();\n    },\n  };\n\n  lifetimes = {\n    created() {\n      this.resetAnimation = wx.createAnimation({\n        duration: 0,\n        timingFunction: 'linear',\n      });\n    },\n\n    detached() {\n      this.clearNoticeBarAnimation();\n    },\n\n    ready() {\n      this.show();\n    },\n  };\n\n  methods = {\n    initAnimation() {\n      // 获取外部容器和滚动内容的宽度\n      const warpID = `.${name}__content-wrap`;\n      const nodeID = `.${name}__content`;\n      getAnimationFrame(() => {\n        Promise.all([getRect(this, nodeID), getRect(this, warpID)]).then(([nodeRect, wrapRect]) => {\n          const { marquee } = this.properties;\n\n          if (nodeRect == null || wrapRect == null || !nodeRect.width || !wrapRect.width) {\n            return;\n          }\n\n          if (marquee || wrapRect.width < nodeRect.width) {\n            const speeding = marquee.speed || 50;\n            const delaying = marquee.delay || 0;\n            const loops = marquee.loop - 1 || -1;\n            const animationDuration = ((wrapRect.width + nodeRect.width) / speeding) * 1000;\n            const firstAnimationDuration = (nodeRect.width / speeding) * 1000;\n\n            this.setData({\n              wrapWidth: Number(wrapRect.width),\n              nodeWidth: Number(nodeRect.width),\n              animationDuration: animationDuration,\n              delay: delaying,\n              loop: loops,\n              firstAnimationDuration: firstAnimationDuration,\n            });\n\n            this.startScrollAnimation(true);\n          }\n        });\n      });\n    },\n\n    startScrollAnimation(isFirstScroll = false) {\n      this.clearNoticeBarAnimation();\n\n      const { wrapWidth, nodeWidth, firstAnimationDuration, animationDuration, delay } = this.data;\n      const delayTime = isFirstScroll ? delay : 0;\n      const durationTime = isFirstScroll ? firstAnimationDuration : animationDuration;\n\n      // 滚动内容: 初始位置\n      this.setData({\n        animationData: this.resetAnimation\n          .translateX(isFirstScroll ? 0 : wrapWidth)\n          .step()\n          .export(),\n      });\n\n      getAnimationFrame(() => {\n        // 滚动内容: 最终位置\n        this.setData({\n          animationData: wx\n            .createAnimation({ duration: durationTime, timingFunction: 'linear', delay: delayTime })\n            .translateX(-nodeWidth)\n            .step()\n            .export(),\n        });\n      });\n\n      // 滚动一次完成, 开启下一次的滚动\n      this.nextAnimationContext = setTimeout(() => {\n        if (this.data.loop > 0) {\n          this.data.loop -= 1;\n          this.startScrollAnimation();\n        } else if (this.data.loop === 0) {\n          // 动画回到初始位置\n          this.setData({ animationData: this.resetAnimation.translateX(0).step().export() });\n        } else if (this.data.loop < 0) {\n          this.startScrollAnimation();\n        }\n      }, durationTime + delayTime);\n    },\n\n    show() {\n      this.clearNoticeBarAnimation();\n      this.setPrefixIcon(this.properties.prefixIcon);\n      this.initAnimation();\n    },\n\n    /** 清除动画 */\n    clearNoticeBarAnimation() {\n      this.nextAnimationContext && clearTimeout(this.nextAnimationContext);\n      this.nextAnimationContext = null;\n    },\n\n    setPrefixIcon(v) {\n      this.setData({\n        _prefixIcon: calcIcon(v, 'error-circle-filled'),\n      });\n    },\n\n    clickPrefixIcon() {\n      this.triggerEvent('click', { trigger: 'prefix-icon' });\n    },\n\n    clickContent() {\n      this.triggerEvent('click', { trigger: 'content' });\n    },\n\n    clickSuffixIcon() {\n      this.triggerEvent('click', { trigger: 'suffix-icon' });\n    },\n\n    clickExtra() {\n      this.triggerEvent('click', { trigger: 'extra' });\n    },\n  };\n}\n"]}