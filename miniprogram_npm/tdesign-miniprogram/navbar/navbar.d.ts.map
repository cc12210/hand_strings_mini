{"version":3,"sources":["../../src/navbar/navbar.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,cAAc,EAAe,MAAM,qBAAqB,CAAC;AAQlE,MAAM,CAAC,OAAO,OAAO,MAAO,SAAQ,cAAc;IAChD,eAAe,WASb;IAEF,KAAK,MAAQ;IAEb,OAAO;;;MAGL;IAEF,UAAU,iCAAS;IAEnB,SAAS;sBACO,MAAM;qCAiBS,GAAG;MAShC;IAEF,IAAI;;;;;MAKF;IAEF,QAAQ;IA4BR,OAAO;;MAqBL;CACH","file":"navbar.d.ts","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport config from '../common/config';\nimport props from './props';\n\nconst { prefix } = config;\nconst name = `${prefix}-navbar`;\n\n@wxComponent()\nexport default class Navbar extends SuperComponent {\n  externalClasses = [\n    `${prefix}-class`,\n    `${prefix}-class-title`,\n    `${prefix}-class-left`,\n    `${prefix}-class-center`,\n    `${prefix}-class-left-icon`,\n    `${prefix}-class-home-icon`,\n    `${prefix}-class-capsule`,\n    `${prefix}-class-nav-btn`,\n  ];\n\n  timer = null;\n\n  options = {\n    addGlobalClass: true,\n    multipleSlots: true,\n  };\n\n  properties = props;\n\n  observers = {\n    visible(this: Navbar, visible) {\n      const { animation } = this.properties;\n      const visibleClass = `${name}${visible ? '--visible' : '--hide'}`;\n      this.setData({\n        visibleClass: `${visibleClass}${animation ? '-animation' : ''}`,\n      });\n      if (this.timer) {\n        clearTimeout(this.timer);\n      }\n      if (animation) {\n        this.timer = setTimeout(() => {\n          this.setData({\n            visibleClass,\n          });\n        }, 300);\n      }\n    },\n    'title,titleMaxLength'(this: any) {\n      const { title } = this.properties;\n      const titleMaxLength = this.properties.titleMaxLength || Number.MAX_SAFE_INTEGER;\n      let temp = title.slice(0, titleMaxLength);\n      if (titleMaxLength < title.length) temp += '...';\n      this.setData({\n        showTitle: temp,\n      });\n    },\n  };\n\n  data = {\n    prefix,\n    classPrefix: name,\n    boxStyle: '',\n    showTitle: '',\n  };\n\n  attached() {\n    // 场景值为1177（视频号直播间）和1175 （视频号profile页）时，小程序禁用了 wx.getMenuButtonBoundingClientRect\n    let rect = null;\n    if (wx.getMenuButtonBoundingClientRect) {\n      rect = wx.getMenuButtonBoundingClientRect();\n    }\n    if (!rect) return;\n    wx.getSystemInfo({\n      success: (res) => {\n        const boxStyleList = [];\n        const { statusBarHeight } = wx.getSystemInfoSync();\n\n        boxStyleList.push(`--td-navbar-padding-top:${statusBarHeight}px`);\n        if (rect && res?.windowWidth) {\n          boxStyleList.push(`--td-navbar-right:${res.windowWidth - rect.left}px`); // 导航栏右侧小程序胶囊按钮宽度\n        }\n        boxStyleList.push(`--td-navbar-capsule-height: ${rect.height}px`); // 胶囊高度\n        boxStyleList.push(`--td-navbar-capsule-width:${rect.width}px`); // 胶囊宽度\n        this.setData({\n          boxStyle: `${boxStyleList.join('; ')}`,\n        });\n      },\n      fail: (err) => {\n        console.error('navbar 获取系统信息失败', err);\n      },\n    });\n  }\n\n  methods = {\n    goBack() {\n      const { delta } = this.data;\n      // eslint-disable-next-line\n      const that = this;\n      this.triggerEvent('go-back');\n      if (delta > 0) {\n        wx.navigateBack({\n          delta,\n          fail(e) {\n            that.triggerEvent('fail', e);\n          },\n          complete(e) {\n            that.triggerEvent('complete', e);\n          },\n          success(e) {\n            that.triggerEvent('success', e);\n          },\n        });\n      }\n    },\n  };\n}\n"]}