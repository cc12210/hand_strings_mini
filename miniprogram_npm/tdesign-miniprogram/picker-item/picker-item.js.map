{"version":3,"sources":["../../src/picker-item/picker-item.ts"],"names":[],"mappings":"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","file":"picker-item.js","sourcesContent":["import { SuperComponent, wxComponent, RelationsOptions } from '../common/src/index';\nimport config from '../common/config';\nimport props from './props';\n\nconst { prefix } = config;\nconst name = `${prefix}-picker-item`;\n\nconst itemHeight = 80;\nconst DefaultDuration = 240;\n\nconst { windowWidth } = wx.getSystemInfoSync();\n\nconst rpx2px = (rpx) => Math.floor((windowWidth * rpx) / 750);\n\nconst range = function (num: number, min: number, max: number) {\n  return Math.min(Math.max(num, min), max);\n};\n\n@wxComponent()\nexport default class PickerItem extends SuperComponent {\n  relations: RelationsOptions = {\n    '../picker/picker': {\n      type: 'parent',\n    },\n  };\n\n  externalClasses = ['class', `${prefix}-class`];\n\n  properties = props;\n\n  observers = {\n    options(this: PickerItem) {\n      this.update();\n    },\n  };\n\n  data = {\n    prefix,\n    classPrefix: name,\n    offset: 0, // 滚动偏移量\n    duration: 0, // 滚动动画延迟\n    value: '',\n    curIndex: 0,\n  };\n\n  methods = {\n    onTouchStart(event) {\n      this.StartY = event.touches[0].clientY;\n      this.StartOffset = this.data.offset;\n      this.setData({ duration: 0 });\n    },\n\n    onTouchMove(event) {\n      const { StartY, StartOffset, itemHeight } = this;\n\n      // touch偏移增量\n      const touchDeltaY = event.touches[0].clientY - StartY;\n      const deltaY = this.calculateViewDeltaY(touchDeltaY);\n\n      this.setData({\n        offset: range(StartOffset + deltaY, -(this.getCount() * itemHeight), 0),\n        duration: DefaultDuration,\n      });\n    },\n\n    onTouchEnd() {\n      const { offset } = this.data;\n      const { options } = this.properties;\n\n      if (offset === this.StartOffset) {\n        return;\n      }\n      // 调整偏移量\n      const index = range(Math.round(-offset / this.itemHeight), 0, this.getCount() - 1);\n      this.setData({\n        curIndex: index,\n        offset: -index * this.itemHeight,\n      });\n\n      if (index === this._selectedIndex) {\n        return;\n      }\n\n      wx.nextTick(() => {\n        this._selectedIndex = index;\n        this._selectedValue = options[index]?.value;\n        this._selectedLabel = options[index]?.label;\n        this.$parent?.triggerColumnChange({\n          index,\n          column: this.columnIndex || 0,\n        });\n      });\n    },\n\n    // 刷新选中状态\n    update() {\n      const { options, value } = this.data;\n\n      const index = options.findIndex((item) => item.value === value);\n      const selectedIndex = index > 0 ? index : 0;\n\n      this.setData({\n        offset: -selectedIndex * this.itemHeight,\n        curIndex: selectedIndex,\n      });\n\n      this._selectedIndex = selectedIndex;\n      this._selectedValue = options[selectedIndex]?.value;\n      this._selectedLabel = options[selectedIndex]?.label;\n    },\n\n    resetOrigin() {\n      this.update();\n    },\n\n    getCount() {\n      return this.data?.options?.length;\n    },\n  };\n\n  /**\n   * 将屏幕滑动距离换算为视图偏移量 模拟渐进式滚动\n   * @param touchDeltaY 屏幕滑动距离\n   */\n  calculateViewDeltaY(touchDeltaY: number): number {\n    return Math.abs(touchDeltaY) > itemHeight ? 1.2 * touchDeltaY : touchDeltaY;\n  }\n\n  created() {\n    this.StartY = 0;\n    this.StartOffset = 0;\n    this.itemHeight = rpx2px(itemHeight);\n  }\n}\n"]}