{"version":3,"sources":["../../src/image-viewer/image-viewer.ts"],"names":[],"mappings":"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","file":"image-viewer.js","sourcesContent":["import { styles, calcIcon } from '../common/utils';\nimport { SuperComponent, wxComponent } from '../common/src/index';\nimport config from '../common/config';\nimport props from './props';\n\nconst { prefix } = config;\nconst name = `${prefix}-image-viewer`;\n\n@wxComponent()\nexport default class ImageViewer extends SuperComponent {\n  externalClasses = [`${prefix}-class`];\n\n  properties = {\n    ...props,\n  };\n\n  data = {\n    prefix,\n    classPrefix: name,\n    currentSwiperIndex: 0,\n    windowHeight: 0,\n    windowWidth: 0,\n    imagesShape: {},\n  };\n\n  options = {\n    multipleSlots: true,\n  };\n\n  controlledProps = [\n    {\n      key: 'visible',\n      event: 'close',\n    },\n  ];\n\n  ready() {\n    this.saveScreenSize();\n  }\n\n  observers = {\n    visible(value) {\n      this.setData({\n        currentSwiperIndex: value ? this.properties.initialIndex : 0,\n      });\n    },\n\n    closeBtn(v) {\n      this.setData({\n        _closeBtn: calcIcon(v, 'close'),\n      });\n    },\n\n    deleteBtn(v) {\n      this.setData({\n        _deleteBtn: calcIcon(v, 'delete'),\n      });\n    },\n  };\n\n  methods = {\n    saveScreenSize() {\n      const { windowHeight, windowWidth } = wx.getSystemInfoSync();\n      this.setData({\n        windowHeight,\n        windowWidth,\n      });\n    },\n\n    calcImageDisplayStyle(imageWidth, imageHeight) {\n      const { windowWidth, windowHeight } = this.data;\n      const ratio = imageWidth / imageHeight;\n      // 图片宽高都小于屏幕宽高\n      if (imageWidth < windowWidth && imageHeight < windowHeight) {\n        return {\n          styleObj: {\n            width: `${imageWidth * 2}rpx`,\n            height: `${imageHeight * 2}rpx`,\n            left: '50%',\n            transform: 'translate(-50%, -50%)',\n          },\n        };\n      }\n      // 图片宽高至少存在一个大于屏幕宽高，此时判断图片宽高比，按长边显示\n      if (ratio >= 1) {\n        return {\n          styleObj: {\n            width: '100vw',\n            height: `${(windowWidth / ratio) * 2}rpx`,\n          },\n        };\n      }\n      return {\n        styleObj: {\n          width: `${ratio * windowHeight * 2}rpx`,\n          height: '100vh',\n          left: '50%',\n          transform: 'translate(-50%, -50%)',\n        },\n      };\n    },\n\n    onImageLoadSuccess(e: WechatMiniprogram.TouchEvent) {\n      const {\n        detail: { width, height },\n        currentTarget: {\n          dataset: { index },\n        },\n      } = e;\n      const { mode, styleObj } = this.calcImageDisplayStyle(width, height);\n      const origin = this.data.imagesShape;\n      this.setData({\n        imagesShape: {\n          ...origin,\n          [index]: {\n            mode,\n            style: styles({ ...styleObj }),\n          },\n        },\n      });\n    },\n\n    onSwiperChange(e: WechatMiniprogram.TouchEvent) {\n      const {\n        detail: { current },\n      } = e;\n      this.setData({\n        currentSwiperIndex: current,\n      });\n      this._trigger('change', { index: current });\n    },\n\n    onClose(e) {\n      const { source } = e.currentTarget.dataset;\n      this._trigger('close', { visible: false, trigger: source || 'button', index: this.data.currentSwiperIndex });\n    },\n\n    onDelete() {\n      this._trigger('delete', { index: this.data.currentSwiperIndex });\n    },\n  };\n}\n"]}