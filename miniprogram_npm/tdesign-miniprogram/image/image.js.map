{"version":3,"sources":["../../src/image/image.ts"],"names":[],"mappings":"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","file":"image.js","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport ImageProps from './props';\nimport config from '../common/config';\nimport { addUnit, getRect } from '../common/utils';\n\nconst { prefix } = config;\nconst name = `${prefix}-image`;\n@wxComponent()\nexport default class Image extends SuperComponent {\n  externalClasses = [`${prefix}-class`, `${prefix}-class-load`];\n\n  options = {\n    multipleSlots: true,\n  };\n\n  properties = ImageProps;\n\n  data = {\n    prefix,\n    isLoading: true,\n    isFailed: false,\n    innerStyle: '',\n    classPrefix: name,\n  };\n\n  preSrc = ''; // 保留上一次的src,防止在src相同时重复update\n\n  lifetimes = {\n    attached() {\n      const { width, height } = this.data;\n      let innerStyle = '';\n      this.update();\n\n      if (width) {\n        innerStyle += `width: ${addUnit(width)};`;\n      }\n      if (height) {\n        innerStyle += `height: ${addUnit(height)};`;\n      }\n      this.setData({\n        innerStyle,\n      });\n    },\n  };\n\n  observers = {\n    src() {\n      if (this.preSrc === this.properties.src) return;\n      this.update();\n    },\n  };\n\n  methods = {\n    onLoaded(e: any) {\n      const sdkVersion = wx.getSystemInfoSync().SDKVersion;\n      const versionArray = sdkVersion.split('.').map((v) => parseInt(v, 10));\n      const { mode } = this.properties;\n      const isInCompatible =\n        versionArray[0] < 2 ||\n        (versionArray[0] === 2 && versionArray[1] < 10) ||\n        (versionArray[0] === 2 && versionArray[1] === 10 && versionArray[2] < 3);\n      // 版本号低于2.10.3时组件内部实现heightFix模式\n      if (mode === 'heightFix' && isInCompatible) {\n        // 实现heightFix模式，保持高度和宽高比，设置对应的宽度\n        const { height: picHeight, width: picWidth } = e.detail;\n        getRect(this, '#image').then((rect) => {\n          const { height } = rect;\n          const resultWidth = ((height / picHeight) * picWidth).toFixed(2);\n          this.setData({ innerStyle: `height: ${addUnit(height)}; width: ${resultWidth}px;` });\n        });\n      }\n      this.setData({\n        isLoading: false,\n        isFailed: false,\n      });\n      this.triggerEvent('load', e.detail);\n    },\n\n    onLoadError(e: any) {\n      this.setData({\n        isLoading: false,\n        isFailed: true,\n      });\n      this.triggerEvent('error', e.detail);\n    },\n\n    update() {\n      const { src } = this.properties;\n      this.preSrc = src;\n      if (!src) {\n        // 链接为空时直接触发加载失败\n        this.onLoadError({ errMsg: '图片链接为空' });\n      } else {\n        this.setData({\n          isLoading: true,\n          isFailed: false,\n        });\n      }\n    },\n  };\n}\n"]}