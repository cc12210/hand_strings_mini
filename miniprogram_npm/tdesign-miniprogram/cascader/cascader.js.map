{"version":3,"sources":["../../src/cascader/cascader.ts"],"names":[],"mappings":"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","file":"cascader.js","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport config from '../common/config';\nimport props from './props';\nimport { TdCascaderProps } from './type';\nimport { getRect } from '../common/utils';\n\nconst { prefix } = config;\nconst name = `${prefix}-cascader`;\n\nexport interface CascaderProps extends TdCascaderProps {}\n\ntype OptionsType = TdCascaderProps['options']['value'];\n\nconst defaultOptionLabel = '选择选项';\n@wxComponent()\nexport default class Cascader extends SuperComponent {\n  externalClasses = [`${prefix}-class`];\n\n  options: WechatMiniprogram.Component.ComponentOptions = {\n    multipleSlots: true,\n  };\n\n  properties = props;\n\n  data = {\n    prefix,\n    name,\n    stepIndex: 0,\n    selectedIndexes: [],\n    selectedValue: [],\n    defaultOptionLabel,\n    scrollTopList: [],\n    steps: [defaultOptionLabel],\n  };\n\n  observers = {\n    visible(v) {\n      if (v) {\n        const $tabs = this.selectComponent('#tabs');\n\n        $tabs?.setTrack();\n        this.updateScrollTop();\n      }\n    },\n    'value, options'() {\n      this.initWithValue();\n    },\n    'selectedIndexes, options'() {\n      const { options, selectedIndexes, keys } = this.data;\n      const selectedValue = [];\n      const steps = [];\n      const items = [options];\n\n      if (options.length > 0) {\n        for (let i = 0, size = selectedIndexes.length; i < size; i += 1) {\n          const index = selectedIndexes[i];\n          const next = items[i][index];\n\n          selectedValue.push(next[keys?.value ?? 'value']);\n          steps.push(next[keys?.label ?? 'label']);\n\n          if (next[keys?.children ?? 'children']) {\n            items.push(next[keys?.children ?? 'children']);\n          }\n        }\n      }\n\n      if (steps.length < items.length) {\n        steps.push(defaultOptionLabel);\n      }\n\n      this.setData({\n        steps,\n        items,\n        selectedValue,\n        stepIndex: items.length - 1,\n      });\n    },\n    async stepIndex() {\n      const { visible } = this.data;\n\n      if (visible) {\n        this.updateScrollTop();\n      }\n    },\n  };\n\n  methods = {\n    initWithValue() {\n      if (this.data.value != null) {\n        const selectedIndexes = this.getIndexesByValue(this.data.options, this.data.value);\n\n        if (selectedIndexes) {\n          this.setData({ selectedIndexes });\n        }\n      }\n    },\n    getIndexesByValue(options: OptionsType, value) {\n      const { keys } = this.data;\n\n      for (let i = 0, size = options.length; i < size; i += 1) {\n        const opt = options[i];\n        if (opt[keys?.value ?? 'value'] === value) {\n          return [i];\n        }\n        if (opt[keys?.children ?? 'children']) {\n          const res = this.getIndexesByValue(opt[keys?.children ?? 'children'], value);\n          if (res) {\n            return [i, ...res];\n          }\n        }\n      }\n    },\n    updateScrollTop() {\n      const { visible, items, selectedIndexes, stepIndex } = this.data;\n\n      if (visible) {\n        getRect(this, '.cascader-radio-group-0').then((rect) => {\n          const eachRadioHeight = rect.height / items[0]?.length;\n\n          this.setData({\n            [`scrollTopList[${stepIndex}]`]: eachRadioHeight * selectedIndexes[stepIndex],\n          });\n        });\n      }\n    },\n    hide() {\n      this.setData({ visible: false });\n    },\n    onStepClick(e) {\n      const { index } = e.currentTarget.dataset;\n\n      this.setData({ stepIndex: index });\n    },\n    onTabChange(e) {\n      const { value } = e.detail;\n\n      this.setData({\n        stepIndex: value,\n      });\n    },\n    handleSelect(e) {\n      const { level } = e.target.dataset;\n      const { value } = e.detail;\n      const { selectedIndexes, items, keys } = this.data;\n      const index = items[level].findIndex((item) => item[keys?.value ?? 'value'] === value);\n      const item = items[level][index];\n\n      if (item.disabled) {\n        return;\n      }\n      selectedIndexes[level] = index;\n      selectedIndexes.length = level + 1;\n\n      this.triggerEvent('pick', item[keys?.value ?? 'value'], index);\n\n      if (item?.[keys?.children ?? 'children']?.length) {\n        this.setData({ selectedIndexes });\n      } else {\n        // setCascaderValue(item.value);\n        this.setData({ selectedIndexes }, () => {\n          const { items } = this.data;\n          this.triggerEvent('change', {\n            value: item[keys?.value ?? 'value'],\n            selectedOptions: items.map((item, index) => item[selectedIndexes[index]]),\n          });\n        });\n        this.hide();\n      }\n    },\n  };\n}\n"]}